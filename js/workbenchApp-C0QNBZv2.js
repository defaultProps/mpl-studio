import"./modulepreload-polyfill-B5Qt9EMX.js";import{d as Q,g as o,j as V,$ as d,a0 as M,r as Y,o as r,b as c,e as s,F as L,f as U,q as _,n as N,t as $,i as D,D as Z,k as x,p as I,h as z,w as ee,u as F,X as le,a2 as ae}from"./.pnpm-CFV4EdYx.js";import{c as m,h as H,W as oe,r as te,i as ne,m as se}from"./index-CHDEKTv2.js";import{p as b,l as O,d as ie}from"./layout-BjYQGacq.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de=""+new URL("../svg/empty-HkTnN1u-.svg",import.meta.url).href,re=["onClick"],ce={class:"label"},ve={key:0,class:"icon icon-arrow-right-filling"},pe={key:1,class:"sub-item--box"},me={class:"label"},fe={class:"content-box"},ge={class:"dragging-mask"},_e={class:"error-dragging-mask"},Ne={class:"global-mask"},be={key:0,class:"empty-box"},ye=Q({__name:"index",emits:["menu"],setup(Ee,{emit:W}){const j=W,P=o(!1),g=o(!1),v=o(!1),f=o(!1),J=o(""),n=o(null),y=o(0),h=o(24),E=o(!0),k=o(!1),w=o(!0),i=o(null),u=o([]),C=o({visible:!1,top:0,left:0}),T=o([]);V(()=>{window.addEventListener("message",a=>{var t;const e=a.data;if(e.type==="UPDATE_ACTIVE_PAGE"&&j("menu",e.payload.id),e.type==="RENDER_NODE_LIST"&&(u.value=JSON.parse(e.payload.nodeStr)),e.type==="UPDATE_ACTIVE_NODE"){const l=e.payload.node?JSON.parse(e.payload.node):"";l&&(u.value=u.value.map(p=>p.cid===l.cid?l:p)),i.value=l,["mpl-dialog","mpl-drawer"].includes(((t=i.value)==null?void 0:t.tag)||"")&&b.scrollIntoViewPopperNode()}if(e.type==="GUILD_LINE_STATUS_ACTION"&&(E.value=e.payload.visible),e.type==="NODE_CALLOUT_LINE_STATUS"&&(k.value=e.payload.visible||!1),e.type==="VISIBLE_NOTE_ACTION"&&(w.value=e.payload.visible),e.type==="PAGE_CHANGE"&&(J.value=e.payload.pageId),e.type==="DRAG_START_ELEMENT"&&(n.value=m.initNode(e.payload.tag),v.value=!1,g.value=!1,["mpl-dialog","mpl-drawer"].includes(e.payload.tag)&&(f.value=!0),n.value)){const{h:l}=n.value.pos.mobile;window.mplHighlightBlockSize=["w-24",`${l}`],y.value=O(h.value)}e.type==="CHANGE_PLATFORM"&&(y.value=O(h.value))},!1)}),V(()=>{const a=JSON.parse(localStorage.getItem("mplInitialWorkbenchView")||"");E.value=a.visibleGuildLine,k.value=a.visibleNodeCalloutLine,w.value=a.visibleNote,n.value=null,g.value=!1,v.value=!1,f.value=!1});function q(a,e){a.stopPropagation();const t=m.mapNodeSetting[e.tag];if(t){T.value=t.node.getContextmenu(i.value);const{top:l,left:p}=te(a,T.value);C.value={visible:!0,top:l,left:p},H(!0)}}function A(a,e=!1){b.selectNodeById(a),y.value=O(h.value),v.value=!1,f.value=!1,g.value=!1;const t=u.value.find(l=>l.cid===a)||null;return t?i.value=t:i.value=null,H(e),t}function X(a){var e,t;b.dropNodePlus(a,((e=n.value)==null?void 0:e.tag)||null),(t=document.getElementById("highlightBlock"))==null||t.remove()}function R(a){a.dataTransfer&&(a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move"),n.value?(ie(a,n.value.pos.mobile),v.value=!1):v.value=!0}d("dropNodePlus",X),d("nodeClick",A),d("nodeContextmenu",q),d("dragover",R),d(m.symbol.VISIBLE_NOTE,M(w)),d(m.symbol.ACTIVE_NODE,i),d(m.symbol.IS_DRAGGER,M(P)),d(m.symbol.DRAG_START_NODE,n);function K(){v.value=!1,f.value=!1,g.value=!1,n.value&&(i.value=n.value,window.mplHighlightBlockSize=["w-24",`${i.value.pos.mobile.h}`],["mpl-drawer","mpl-dialog"].includes(i.value.tag)?u.value.unshift(i.value):u.value.push(i.value),b.updateNodeList(u.value),A(n.value.cid),n.value=null,window.draggingBlock&&(window.draggingBlock.style.display="none"))}return(a,e)=>{const t=Y("van-form");return r(),c(L,null,[s("div",{id:"contextmenuMounted",style:Z({top:`${C.value.top}px`,left:`${C.value.left}px`})},[(r(!0),c(L,null,U(T.value,l=>{var p;return r(),c("div",{key:l.value,class:N(["menu",{disabled:l.disabled,divider:l.divider}]),onClick:_(l.onClick,["stop"])},[s("i",{class:N(["mpl icon",l.icon])},null,2),s("span",ce,$(l.label),1),(p=l.children)!=null&&p.length?(r(),c("i",ve)):D("",!0),Array.isArray(l.children)?(r(),c("div",pe,[(r(!0),c(L,null,U(l.children,S=>(r(),c("div",{key:S.label,class:"menu"},[s("i",{class:N(["mpl icon",S.icon])},null,2),s("span",me,$(S.label),1)]))),128))])):D("",!0)],10,re)}),128))],4),s("div",fe,[s("div",{id:"workbenchDragContainer",class:N(["mounted-workbench-box mpl-scroll-none",[{guild:E.value,callout:k.value}]]),onClick:e[0]||(e[0]=l=>A("mpl-body-cid")),onDragover:e[1]||(e[1]=_(l=>R(l),["prevent"])),onDragleave:e[2]||(e[2]=_(()=>{},["prevent","stop"])),onDrop:_(K,["stop"])},[x(s("div",ge,null,512),[[I,P.value]]),x(s("div",_e,null,512),[[I,v.value]]),x(s("div",Ne,null,512),[[I,f.value]]),z(t,{"status-icon":"",class:"mpl-root-form"},{default:ee(()=>[z(F(oe),{"node-list":F(m).api.formatNodeListToTree(u.value),ui:"vant4"},null,8,["node-list"]),u.value.length===0?(r(),c("div",be,e[3]||(e[3]=[s("img",{src:de,alt:""},null,-1),s("span",null,"无内容页面",-1)]))):D("",!0)]),_:1})],34)])],64)}}}),he=ue(ye,[["__scopeId","data-v-051f77c5"]]);function B(){ne()}document.addEventListener("contextmenu",B);document.addEventListener("click",B);document.addEventListener("mousewheel",B);const G=le(he);G.use(ae);se.initStore(G);G.mount("#lcsWorkbenchDFN");
