import"./modulepreload-polyfill-B5Qt9EMX.js";import{d as Z,g as t,j as B,$ as _,a0 as X,r as $,o as s,b as r,e as o,F as E,f as L,q as M,n as C,t as I,i as P,D as ee,k as D,p as O,h as G,w as S,u as Y,c as K,l as se,X as ie,a1 as ue,Y as re}from"./.pnpm-CFV4EdYx.js";import{c as y,h as Q,W as ce,r as de,m as le,i as ve}from"./index-CHDEKTv2.js";import{_ as pe,a as me}from"./file-DXuT3BQ1.js";import{p as A,l as W,d as fe}from"./layout-BjYQGacq.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e=["onClick"],ge={class:"label"},be={key:0,class:"icon icon-arrow-right-filling"},he={key:1,class:"sub-item--box"},ye={class:"label"},Ne={class:"content-box"},ke={key:0,class:"dividing-rule--box"},Ee={class:"dragging-mask"},Ce={class:"error-dragging-mask"},we={class:"global-mask"},xe=Z({__name:"mountedContent",emits:["menu"],setup(V,{emit:w}){const p=w,N=t(!1),g=t(!1),v=t(!1),b=t(!1),j=t(""),i=t(null),c=t(0),d=t(24),k=t(!0),x=t(!1),T=t(!0),h=t(Array.from({length:24}).fill("").map((a,e)=>e+1)),n=t(null),f=t([]),U=t({visible:!1,top:0,left:0}),F=t([]);B(()=>{window.addEventListener("message",a=>{var u;const e=a.data;if(e.type==="UPDATE_ACTIVE_PAGE"&&p("menu",e.payload.id),e.type==="RENDER_NODE_LIST"&&(f.value=JSON.parse(e.payload.nodeStr)),e.type==="UPDATE_ACTIVE_NODE"){const l=e.payload.node?JSON.parse(e.payload.node):"";l&&(f.value=f.value.map(m=>m.cid===l.cid?l:m)),n.value=l,["mpl-dialog","mpl-drawer"].includes(((u=n.value)==null?void 0:u.tag)||"")&&A.scrollIntoViewPopperNode()}if(e.type==="GUILD_LINE_STATUS_ACTION"&&(k.value=e.payload.visible),e.type==="NODE_CALLOUT_LINE_STATUS"&&(x.value=e.payload.visible||!1),e.type==="VISIBLE_NOTE_ACTION"&&(T.value=e.payload.visible),e.type==="PAGE_CHANGE"&&(j.value=e.payload.pageId),e.type==="DRAG_START_ELEMENT"&&(i.value=y.initNode(e.payload.tag),v.value=!1,g.value=!1,["mpl-dialog","mpl-drawer"].includes(e.payload.tag)&&(b.value=!0),i.value)){const{w:l,h:m}=i.value.pos.pc;window.mplHighlightBlockSize=[`w-${l}`,`h-${m}`],c.value=W(d.value)}e.type==="CHANGE_PLATFORM"&&(c.value=W(d.value))},!1)}),B(()=>{const a=JSON.parse(localStorage.getItem("mplInitialWorkbenchView")||"");k.value=a.visibleGuildLine,x.value=a.visibleNodeCalloutLine,T.value=a.visibleNote,i.value=null,g.value=!1,v.value=!1,b.value=!1});function ae(a,e){a.stopPropagation();const u=y.mapNodeSetting[e.tag];if(u){F.value=u.node.getContextmenu(n.value);const{top:l,left:m}=de(a,F.value);U.value={visible:!0,top:l,left:m},Q(!0)}}function z(a,e=!1){A.selectNodeById(a),c.value=W(d.value),v.value=!1,b.value=!1,g.value=!1;const u=f.value.find(l=>l.cid===a)||null;return u?n.value=u:n.value=null,Q(e),u}function te(a){var e,u;A.dropNodePlus(a,((e=i.value)==null?void 0:e.tag)||null),(u=document.getElementById("highlightBlock"))==null||u.remove()}function q(a){a.dataTransfer&&(a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move"),i.value?(fe(a,i.value.pos.pc),v.value=!1):v.value=!0}_("dropNodePlus",te),_("nodeClick",z),_("nodeContextmenu",ae),_("dragover",q),_(y.symbol.VISIBLE_NOTE,X(T)),_(y.symbol.ACTIVE_NODE,n),_(y.symbol.IS_DRAGGER,X(N)),_(y.symbol.DRAG_START_NODE,i);function ne(){v.value=!1,b.value=!1,g.value=!1,i.value&&(n.value=i.value,window.mplHighlightBlockSize=[`w-${n.value.pos.pc.w}`,`h-${n.value.pos.pc.h}`],["mpl-drawer","mpl-dialog"].includes(n.value.tag)?f.value.unshift(n.value):f.value.push(n.value),A.updateNodeList(f.value),z(i.value.cid),i.value=null,window.draggingBlock&&(window.draggingBlock.style.display="none"))}return(a,e)=>{const u=$("el-form");return s(),r(E,null,[o("div",{id:"contextmenuMounted",style:ee({top:`${U.value.top}px`,left:`${U.value.left}px`})},[(s(!0),r(E,null,L(F.value,l=>{var m;return s(),r("div",{key:l.value,class:C(["menu",{disabled:l.disabled,divider:l.divider}]),onClick:M(l.onClick,["stop"])},[o("i",{class:C(["mpl icon",l.icon])},null,2),o("span",ge,I(l.label),1),(m=l.children)!=null&&m.length?(s(),r("i",be)):P("",!0),Array.isArray(l.children)?(s(),r("div",he,[(s(!0),r(E,null,L(l.children,J=>(s(),r("div",{key:J.label,class:"menu"},[o("i",{class:C(["mpl icon",J.icon])},null,2),o("span",ye,I(J.label),1)]))),128))])):P("",!0)],10,_e)}),128))],4),o("div",Ne,[k.value?(s(),r("div",ke,[(s(!0),r(E,null,L(h.value,l=>(s(),r("div",{key:l},[o("span",null,I(l),1)]))),128))])):P("",!0),o("div",{id:"workbenchDragContainer",class:C(["mounted-workbench-box mpl-scroll-none",[{guild:k.value,callout:x.value}]]),onClick:e[0]||(e[0]=l=>z("mpl-body-cid")),onDragover:e[1]||(e[1]=M(l=>q(l),["prevent"])),onDragleave:e[2]||(e[2]=M(()=>{},["prevent","stop"])),onDrop:M(ne,["stop"])},[D(o("div",Ee,null,512),[[O,N.value]]),D(o("div",Ce,null,512),[[O,v.value]]),D(o("div",we,null,512),[[O,b.value]]),G(u,{"status-icon":"",class:"mpl-root-form"},{default:S(()=>[G(Y(ce),{"node-list":Y(y).api.formatNodeListToTree(f.value),ui:"elementPlus"},null,8,["node-list"])]),_:1})],34)])],64)}}}),Te=oe(xe,[["__scopeId","data-v-38a2fc85"]]),Se={class:"root-mp--box"},Ae={class:"sidebar-box"},Le={key:0},Ie={src:me},De={class:"content-box"},Oe={class:"header-box"},Me=Z({__name:"index",setup(V){const w=le.projectStore(),p=t(!0),N=t(""),g=t([]),v=t("mpl-dfn");function b(c){N.value=c}function j(c){A.clickMenu(c)}B(()=>{var c;N.value=((c=w.activeFile)==null?void 0:c.id)||""}),B(()=>{window.addEventListener("message",c=>{const d=c.data;d.type==="INIT_PROJECT_DIR"&&(g.value=JSON.parse(d.payload.projectTree))})});function i(){v.value=v.value==="mpl-dfn"?"mpl-pqc":"mpl-dfn"}return(c,d)=>{const k=$("el-menu-item"),x=$("el-sub-menu"),T=$("el-menu");return s(),r("div",Se,[o("div",Ae,[o("div",{class:C(["header-logo",{"is-collapse":p.value}])},[d[1]||(d[1]=o("img",{src:pe,alt:"logo"},null,-1)),p.value?P("",!0):(s(),r("h1",Le," MPL云服务中心 "))],2),G(T,{"active-text-color":"var(--color-7)","text-color":"#c8c9cc",collapse:p.value,"menu-trigger":"click","background-color":"var(--color-3)","default-active":N.value,class:"mpl-scroll-none",onSelect:j},{default:S(()=>[(s(!0),r(E,null,L(g.value,h=>(s(),K(x,{key:h.id,index:h.id},{title:S(()=>[D(o("img",Ie,null,512),[[O,p.value]]),D(o("div",null,I(h.title),513),[[O,!p.value]])]),default:S(()=>[(s(!0),r(E,null,L(h.children,n=>(s(),K(k,{key:n.id,index:n.id},{default:S(()=>[se(I(n.title),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"]))),128))]),_:1},8,["collapse","default-active"])]),o("div",De,[o("div",Oe,[o("div",{class:"trigger-btn",onClick:d[0]||(d[0]=h=>p.value=!p.value)},[o("i",{class:C(["icon",[p.value?"icon-double-arro-right":"icon-double-arrow-left"]])},null,2)]),o("div",{class:"trigger-btn icon icon-theme1",style:ee({color:v.value==="mpl-dfn"?"var(--color-4)":"#196eff"}),onClick:i},null,4)]),G(Te,{onMenu:b}),d[2]||(d[2]=o("div",{class:"footer-box"},[o("div",{class:"tag-box"},[o("span",null,"底部页签"),o("i",{class:"icon icon-close1"})])],-1))])])}}}),$e=oe(Me,[["__scopeId","data-v-b98b5e39"]]);function H(){ve()}document.addEventListener("contextmenu",H);document.addEventListener("click",H);document.addEventListener("mousewheel",H);const R=ie($e);for(const[V,w]of Object.entries(ue))R.component(V,w);R.use(re);le.initStore(R);R.mount("#lcsWorkbenchDFN");
